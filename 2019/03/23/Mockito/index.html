<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!--<![endif]-->

<head>
  <title>Mockito | This is Qi</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="This is Qi">
    <meta name="author" content="Qi Tan">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="This is Qi" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="www.linkedin.com/in/qi-tan/" class="animsition-link">Linkedin</a></li>
                    
                    <li><a href="www.github.com/TQJADE" class="animsition-link">Github</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">This is Qi</a></li>
                            <li class="nolink"><span>Break Out of Your Comfort Zone</span></li>
                            
                            <li><a href="https://github.com/TQJADE" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            
                            
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<script>
  var disqus_shortname = 'qitan';
  
  var disqus_url = 'http://tqjade.github.io/2019/03/23/Mockito/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2019-03-24T04:58:29.000Z" itemprop="datePublished">
          2019-03-23
      </time>
    
    
    | 
    <a href='/tags/Test/'>Test</a>
    
    
</span>
                <h1>Mockito</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<p>Mockito is one of the most popular mocking framework for java. For me, it is frequently used in daily unit test . I would like to note down some basic usages. </p>
<h2 id="Unit-Test-and-Mocking"><a href="#Unit-Test-and-Mocking" class="headerlink" title="Unit Test and Mocking"></a>Unit Test and Mocking</h2><p>We do need the unit test to test our method, our interface, our class, to see whether it performs correctly, especially for methods with complicated business logic. When testing an object which has dependencies on other complex objects, you do not want to create real objects for the unit test.  Here comes the mocking that mimics the behavior of real objects.</p>
<h2 id="Basic-Mockito"><a href="#Basic-Mockito" class="headerlink" title="Basic Mockito"></a>Basic Mockito</h2><p>Mockito three phrases:</p>
<ol>
<li>Mock away external dependencies and insert the mocks into the code under test</li>
<li>Execute the code under test</li>
<li>Validate that the code executed correctly</li>
</ol>
<p>Here is an example I would like to use. Suppose I have a StockService.</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class Stock {</span><br><span class="line">    private String symbol;</span><br><span class="line">    private Double quotePrice;</span><br><span class="line"></span><br><span class="line">    public String getSymbol() {</span><br><span class="line">        return symbol;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setSymbol(String symbol) {</span><br><span class="line">        this.symbol = symbol;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public Double getQuotePrice() {</span><br><span class="line">        return quotePrice;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setQuotePrice(Double quotePrice) {</span><br><span class="line">        this.quotePrice = quotePrice;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface AutoComplete {</span><br><span class="line">    public String getSymbol(String companyName) throws TimeoutException;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface Quotes {</span><br><span class="line">    public Double getQuotes (String symbol) throws TimeoutException;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public class StockService {</span><br><span class="line">    private AutoComplete autoComplete;</span><br><span class="line">    private Quotes quotes;</span><br><span class="line">    private List&lt;Stock&gt; portfolio;</span><br><span class="line"></span><br><span class="line">    public StockService(AutoComplete autoComplete, Quotes quotes) {</span><br><span class="line">        this.autoComplete = autoComplete;</span><br><span class="line">        this.quotes = quotes;</span><br><span class="line">        portfolio = new ArrayList&lt;&gt;();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public List&lt;Stock&gt; getPortfolio() {</span><br><span class="line">        return portfolio;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setPortfolio(List&lt;Stock&gt; portfolio) {</span><br><span class="line">        this.portfolio = portfolio;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public Double getStockPrice(String searchInput) {</span><br><span class="line">        try {</span><br><span class="line">            String symbol = autoComplete.getSymbol(searchInput);</span><br><span class="line">            return quotes.getQuotes(symbol);</span><br><span class="line">        } catch (NullPointerException e) {</span><br><span class="line">            return 0.0;</span><br><span class="line">        } catch (TimeoutException e) {</span><br><span class="line">            return 0.0;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void addStockToPortfolio(Stock stock) {</span><br><span class="line">        portfolio.add(stock);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">public class StockServiceTest {</span><br><span class="line">    @Mock</span><br><span class="line">    private Quotes quotes;</span><br><span class="line">    @Mock</span><br><span class="line">    private AutoComplete autoComplete;</span><br><span class="line"></span><br><span class="line">    private StockService stockService;</span><br><span class="line"></span><br><span class="line">    @BeforeMethod</span><br><span class="line">    public void setup() {</span><br><span class="line">        MockitoAnnotations.initMocks(this);</span><br><span class="line">        stockService = new StockService(autoComplete, quotes);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testStockServiceWithValidInput() throws TimeoutException {</span><br><span class="line">        String input = &quot;Apple&quot;;</span><br><span class="line">        when(autoComplete.getSymbol(input)).thenReturn(&quot;AAPL&quot;);</span><br><span class="line">        when(quotes.getQuotes(&quot;AAPL&quot;)).thenReturn(164.00);</span><br><span class="line">        double applePrice = stockService.getStockPrice(input);</span><br><span class="line">        assertEquals(applePrice, 164.00);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testStockServiceWithInvalidInput() throws TimeoutException {</span><br><span class="line">        when(autoComplete.getSymbol(anyString())).thenReturn(null);</span><br><span class="line">        assertEquals(stockService.getStockPrice(&quot;foo&quot;), 0.0);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Test </span><br><span class="line">    void testStockServiceWithTimeout() throws TimeoutException {</span><br><span class="line">        String input = &quot;apple&quot;;</span><br><span class="line">        when(autoComplete.getSymbol(input)).thenThrow(new TimeoutException(&quot;Time out&quot;));</span><br><span class="line">        assertEquals(stockService.getStockPrice(input), 0.0);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>Use <code>@Mock</code>  to create mock objects. Add <code>MockitoAnnotations.initMocks(this)</code>  to populate the annotated fields.<br>Utilize <code>when(...).thenReturn(...)</code>  or <code>when(&#x2026;).thenThrow(&#x2026;)</code>  to imitate methods.<br>Verify the results via <code>verify()</code>  / <code>assert()</code> to check logic.  </p>
<h2 id="Spy-amp-ArgumentCaptor"><a href="#Spy-amp-ArgumentCaptor" class="headerlink" title="Spy &amp; ArgumentCaptor"></a>Spy &amp; ArgumentCaptor</h2><p><code>@Spy</code> or <code>spy()</code> means you want to spying on the real objects which can be associated with &#x201C;partial mocking&#x201D; concept.  Take <strong>real</strong> into consideration. There exists difference in using <code>when(&#x2026;).thenReturn(&#x2026;)</code> and <code>doReturn(...).when(...)</code><br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List list = new LinkedList();</span><br><span class="line">List spy = spy(list);</span><br><span class="line"></span><br><span class="line">//Impossible: real method is called so spy.get(0) throws IndexOutOfBoundsException (the list is yet empty)</span><br><span class="line">when(spy.get(0)).thenReturn(&quot;foo&quot;);</span><br><span class="line"></span><br><span class="line">//You have to use doReturn() for stubbing</span><br><span class="line">doReturn(&quot;foo&quot;).when(spy).get(0);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>At the same time, we can make use of <code>ArgumentCaptor</code> to verifies argument values. It is recommended to use ArgumentCaptor with verification but not with stubbing. In some situations though, it is helpful to <strong>assert</strong> on certain arguments <strong>after</strong> the actual <strong>verification</strong>. Suppose that we want to test whether the stock is added to stockList via <code>addStockToPortfolio()</code> , argumentCaptor could be a way to captor and test.</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Test void testPortfolio() {</span><br><span class="line">        List&lt;Stock&gt; stockList = mock(List.class);</span><br><span class="line">        ArgumentCaptor&lt;Stock&gt; stockArgument = ArgumentCaptor.forClass(Stock.class);</span><br><span class="line">        stockService.setPortfolio(stockList);</span><br><span class="line"></span><br><span class="line">        Stock apple = new Stock();</span><br><span class="line">        apple.setSymbol(&quot;AAPL&quot;);</span><br><span class="line">        apple.setQuotePrice(164.00);</span><br><span class="line"></span><br><span class="line">        stockService.addStockToPortfolio(apple);</span><br><span class="line">        verify(stockList).add(stockArgument.capture());</span><br><span class="line"></span><br><span class="line">        assertEquals(stockArgument.getValue().getSymbol(), &quot;AAPL&quot;);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h2 id="With-Guava"><a href="#With-Guava" class="headerlink" title="With Guava"></a>With Guava</h2><p>Besides to setter to access to private field and mock its method, we can use Guava&#x2019; s <code>@VisibleForTesting</code> to help us. Here is one example. Suppose I remove autocomplete and quote services from constructor.   </p>
<pre><code>public StockService() {
    portfolio = new ArrayList&lt;&gt;();
    autoComplete = ..;
    quotes = ..;
}

@VisibleForTesting
public StockService(AutoComplete autoComplete, Quotes quotes) {
    portfolio = new ArrayList&lt;&gt;();
    this.autoComplete = autoComplete;
    this.quotes = quotes;
}
</code></pre><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.vogella.com/tutorials/Mockito/article.html" target="_blank" rel="noopener">https://www.vogella.com/tutorials/Mockito/article.html</a><br><a href="https://static.javadoc.io/org.mockito/mockito-core/2.25.1/org/mockito/Mockito.html#13" target="_blank" rel="noopener">https://static.javadoc.io/org.mockito/mockito-core/2.25.1/org/mockito/Mockito.html#13</a></p>
<p>To be continued.. 
<img width="20" height="20" class="emoji nofancybox" title=":smile:" alt="&#x1F604;" src="/images/emoji/smile.png" style="">
 </p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="m-pagination col-md-8 col-md-offset-2 col-sm-24" role="pagination">
    
    <a class="pull-left" href="/2019/04/15/清明/" style="float: left;">
        ← 清明
    </a>
    
    
    <a class="pull-right" href="/2019/03/12/二月二/">
        二月二 →
    </a>
    
</nav>

        <div class="col-md-8 col-md-offset-2 col-sm-24">
<script>
  var disqus_shortname = 'qitan';
  
  var disqus_url = 'http://tqjade.github.io/2019/03/23/Mockito/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

</div>
        <div class="col-md-8 col-md-offset-2" id="disqus_thread"></div>
    </div>
</section>


      <footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By Qi Tan. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/TQJADE" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    
                    
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>


      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



      
</body>
</html>
